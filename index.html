<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>browser tab notification</title>

	<link id="favicon" rel="icon" href="show.png"/>
	
	<style>
		#container {
			width: 980px;
			margin: 0 auto
		}
		pre {
			display: block;
			padding: 9.5px;
			margin: 0 0 10px;
			font-size: 13px;
			line-height: 1.428571429;
			color: #333;
			word-break: break-all;
			word-wrap: break-word;
			background-color: #f5f5f5;
			border: 1px solid #ccc;
			border-radius: 4px;
			max-width: 700px
		}
	</style>
</head>
<body>

	<div id="container">
		<h1>Exemplo de interação com o favicon na troca de abas.</h1>
		<ul>
			<li><a href="#number">Usando notificação com favico.js </a> (Chrome, Firefox, Opera)</li>
			<li><a href="#bullet">Alterando o title</a> (Chrome, Firefox, Opera, IE11+)</li>
			<li><a href="#image">Alterando a imagem</a> (Chrome, Firefox, Opera, IE11+)</li>
		</ul>

		<pre>
var interval;
var favicon = new Favico({
  animation:'popFade',
  bgColor : '#1b0cc9'
});

function handleVisibilityChange() {

  if(location.hash == '#number'){	
    if (isHidden()) {
      var count = 1;
      interval = setInterval(function(){
        favicon.badge(count);
        count++;
      }, 3000)

    } else  {
      clearInterval(interval);
      favicon.reset();
    }
  }else if(location.hash == '#bullet'){	
    if (isHidden()) {
      var count = 1;
      interval = setInterval(function(){
        document.title = "(" + count + ") browser tab notification";
        count++;
      }, 3000)
    } else  {
      document.title = "browser tab notification";
      clearInterval(interval);
    }
  }else{
    if (isHidden()) {
      document.querySelector('link[rel=icon]').href = 'hidden.png';
    } else  {
      document.querySelector('link[rel=icon]').href = 'show.png';
    }
  }
}

function getHiddenProp(){
  var prefixes = ['webkit','moz','ms','o'];
		
  if ('hidden' in document) return 'hidden';
		
  for (var i = 0; i < prefixes.length; i++){
    if ((prefixes[i] + 'Hidden') in document) 
      return prefixes[i] + 'Hidden';
  }

  return null;
}

function isHidden() {
  var prop = getHiddenProp();
  if (!prop) return false;

  return document[prop];
}

document.addEventListener("visibilitychange", handleVisibilityChange, false);
		</pre>

		<p>Troque de aba para ver o resultado.</p>
	</div>
	<script src="favico.min.js"></script>
	<script>

		window.onload = function(){

			var interval;
			var favicon = new Favico({
				animation:'popFade',
				bgColor : '#1b0cc9'
			});

			function handleVisibilityChange() {
	
				if(location.hash == '#number'){	
					if (isHidden()) {
						var count = 1;
						interval = setInterval(function(){
							favicon.badge(count);
							count++;
						}, 3000)

					} else  {
						clearInterval(interval);
						favicon.reset();
					}
				}else if(location.hash == '#bullet'){	
					if (isHidden()) {
						var count = 1;
						interval = setInterval(function(){
							document.title = "(" + count + ") browser tab notification";
							count++;
						}, 3000)
					} else  {
						document.title = "browser tab notification";
						clearInterval(interval);
					}
				}else{
					if (isHidden()) {
						document.querySelector('link[rel=icon]').href = 'hidden.png';
					} else  {
						document.querySelector('link[rel=icon]').href = 'show.png';
					}
				}
			}

			function getHiddenProp(){
				var prefixes = ['webkit','moz','ms','o'];
					
				if ('hidden' in document) return 'hidden';
					
				for (var i = 0; i < prefixes.length; i++){
					if ((prefixes[i] + 'Hidden') in document) 
						return prefixes[i] + 'Hidden';
				}

				return null;
			}

			function isHidden() {
				var prop = getHiddenProp();
				if (!prop) return false;
    
				return document[prop];
			}

			document.addEventListener("visibilitychange", handleVisibilityChange, false);
		}

	</script>

</body>
</html>
